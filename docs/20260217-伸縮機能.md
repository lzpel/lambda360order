たとえば板金加工の箱を作っているメーカーがあるとして、
基準となる箱のstepファイルを用意して、縦と横の長さを入力すると中央部分を引き延ばしてその寸法の箱のCADを表示することはopencascade-rsで可能でしょうか？

元：===|===
伸：===|====|===

## 回答

はい、OpenCascadeで可能です。この操作は「ダイレクトモデリングのストレッチ」と呼ばれる手法で実現できます。

### 基本的なアプローチ

1. **STEPファイルの読み込み** - `STEPControl_Reader` でベースとなる箱の形状を読み込む
2. **切断面の定義** - 伸ばしたい方向の中央に切断平面（`gp_Pln`）を設定
3. **形状を2分割** - `BRepAlgoAPI_Cut` または `BRepBuilderAPI_Split` でソリッドを切断
4. **片側を移動** - `BRepBuilderAPI_Transform` で片方を伸ばしたい量だけ平行移動
5. **隙間を埋める** - 切断面間を `BRepOffsetAPI_ThruSections`（ロフト）や押し出しで接続
6. **結合** - `BRepAlgoAPI_Fuse` で一体化

### 概念図

```
元の箱:     [====A====|====B====]
              ← 切断面

伸ばした後:  [====A====|  隙間  |====B====]
                       ↑ 新規生成 ↑
              Bをδだけ平行移動
```

### OpenCascade.js (このプロジェクト) での実装例イメージ

```typescript
// 1. STEP読み込み
const reader = new oc.STEPControl_Reader_1();
reader.ReadFile("box.step");
reader.TransferRoots(new oc.Message_ProgressRange_1());
const shape = reader.OneShape();

// 2. 切断平面（X方向中央で切る場合）
const cutPlane = new oc.gp_Pln_3(
  new oc.gp_Pnt_3(centerX, 0, 0),
  new oc.gp_Dir_4(1, 0, 0)
);

// 3. 分割
const halfPlane = new oc.BRepBuilderAPI_MakeFace_8(cutPlane);
const splitter = new oc.BRepAlgoAPI_Splitter_1();
// ... 分割処理

// 4. 片側を平行移動
const trsf = new oc.gp_Trsf_1();
trsf.SetTranslation_1(new oc.gp_Vec_4(deltaX, 0, 0));
const moved = new oc.BRepBuilderAPI_Transform_2(partB, trsf, true);

// 5. 隙間を埋めて結合
const fused = new oc.BRepAlgoAPI_Fuse_3(partA, bridge, ...);
```

### 注意点・考慮事項

- **単純な箱形状**であれば上記アプローチで比較的簡単に実現可能
- **板金の曲げ・フランジ**がある複雑な形状の場合、切断面の位置選定が重要（曲げ部分を避ける）
- **縦・横両方向**に伸ばす場合は、2回に分けて処理する（X方向→Y方向）
- **opencascade-rs**（Rust版）でも同じAPIが使えるので、同様のアプローチが可能
- このプロジェクトでは **opencascade.js v2** を使用中なので、Web上でリアルタイムプレビューも実現できる

### 代替アプローチ

もし箱が単純な直方体ベースなら、STEPを伸ばすよりも**パラメトリックに再構築**する方がクリーンな場合もある：

- ベースSTEPから寸法を抽出
- 指定寸法で `BRepPrimAPI_MakeBox` で再生成
- 板金の曲げ等の特徴を再適用

どちらのアプローチで進めるかは、対象となる箱の複雑さ次第。