# 埋め込み方式の技術比較：iframe vs React Mount

「外部サイト（WordPressやShopify等）にLambda360の3Dビューワーを表示する」ための2つの技術的アプローチについて、仕組みの違いと現状のギャップを整理します。

---

## 1. iframe方式 (現在のアプローチ)

**「別のWebサイトを窓の中に表示する」** という、最も標準的で簡単な方法です。YouTubeの埋め込みと同じ仕組みです。

### 仕組み
1.  **ビルド**: Next.jsアプリとして通常通りビルドし、Vercel等にデプロイします（`https://lambda360.com/viewer`）。
2.  **埋め込み**: 外部サイトに `<iframe src="https://lambda360.com/viewer" />` を貼ります。
3.  **動作**: ブラウザはiframeの中で「別のページ」としてLambda360を読み込みます。

### メリット
*   **開発が楽**: 今のNext.jsアプリそのままでOK。特別なビルド設定が不要。
*   **CSS/JSの競合なし**: 親サイトのデザイン（CSS）が崩れたり、変なJSエラーが起きたりしません（完全に隔離されている）。
*   **キャッシュ効率**: ブラウザがiframeの中身をキャッシュしてくれるので、次回以降の表示が速い。

### デメリット
*   **初期ロード**: iframeの中身を含めて「ページ全体」を読み込むため、少し重い。
*   **連携の制限**: 親サイトとデータのやり取り（例：ボタンを押したら色が変わる）をするには `postMessage` という通信が必要で、少し面倒。

---

## 2. React Mount方式 (Widget/Web Component)

**「JSライブラリとして読み込み、その場のdivに描画する」** 方法です。Google MapsやStripeの決済フォームに近い仕組みです。

### 仕組み
1.  **ビルド**: Reactコンポーネントとランタイムを **「1つのJSファイル (bundle.js)」** に固める必要があります。
    *   Next.jsのビルドシステム（Webpack）は「ページ分割」を前提としているため、**これを作るのが非常に苦手です。**
    *   通常は **Vite** や **Rollup** といった別のツールを使って、「ライブラリモード」でビルドします。
2.  **埋め込み**: `<script src="https://cdn.lambda360.com/widget.js"></script>` を読み込み、`Lambda360.render('#container')` のように実行します。
3.  **動作**: 現在のページのDOMに対して、JavaScriptが直接HTML要素を生成して貼り付けます。

### メリット
*   **シームレス**: 親サイトの一部として自然に馴染みます（iframeの枠線やスクロールバーが出ない）。
*   **連携が楽**: 親サイトの変数をそのままJSのプロパティとして渡せます。
*   **軽量**: 必要なコードだけを読み込むので（理論上は）速いです。

### デメリット
*   **スタイル競合**: 親サイトのCSS（global.css）がビューワーのデザインを壊す可能性があります（「ボタンの色が変わっちゃった」等）。
    *   Shadow DOMを使えば防げますが、実装難易度が上がります。
*   **バージョン管理**: Reactのバージョンが親サイトと競合する可能性があります（親サイトもReactを使っている場合）。

---

## 3. 現状のレポジトリとの距離（ギャップ）

今の `lambda360order` レポジトリは **「Next.js アプリケーション」** として作られています。
これを「React Mount方式」に対応させるには、以下の作業が必要です。

### 必要な変更 (難易度: 高)
1.  **ビルド環境の分離**:
    *   Next.js (`npm run build`) はアプリを作るためのものです。
    *   「部品（Widget）」を作るために、新たに **Vite** または **Microbundle** などのビルド設定を追加する必要があります。
    *   `vite.config.ts` を作り、`src/components/Viewer.tsx` だけをエントリーポイントとしてビルドするように設定します。

2.  **依存関係の解決**:
    *   `opencascade.js` や `wasm` ファイルは、Next.jsの `public/` フォルダに置いて配信していますが、Widget化する場合は **「JSの中からどうやってWASMを読み込むか」** を解決する必要があります。
    *   通常はWASMファイルをCDNに置き、そのURLをハードコードするか、JS起動時にオプションとして渡す必要があります。

3.  **Next.js依存の削除**:
    *   もしビューワー部分で `next/image` や `next/link`、`next/router` を使っていたら、それらは動きません（Next.jsのサーバーが必要だからです）。
    *   純粋な `<img>` タグや `<a>` タグ、標準の `fetch` に書き換える必要があります。

### 推奨される進め方
今のフェーズ（0→1）では、**iframe方式で進めるべき** です。
ユーザー体験（UX）に大きな差はありませんし、開発工数が圧倒的に少なくて済みます。
「React Mount方式」は、将来的に「Shopifyアプリとして高度な連携が必要になった」時に検討すれば十分です。
