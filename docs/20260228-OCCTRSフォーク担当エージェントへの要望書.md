# 20260228-OCCTRSフォーク担当エージェントへの要望書

対象フォーク: https://github.com/lzpel/opencascade-rs

---

## 要望1：BRepBuilderAPI_Copy の公開（高優先度）

### 問題

`union` / `intersect` / `subtract` / `clean` を連鎖させると、プロセス終了時に `STATUS_HEAP_CORRUPTION (0xc0000374)` が発生する。テスト本体は成功するが、Drop フェーズで C++ デストラクタがクラッシュする。

### 原因

現状の `TopoDS_Shape_to_owned` は shallow copy（Handle のみコピー）のため、ブーリアン演算結果が入力形状のデータを Handle を経由せず保持し続ける。入力を早期 drop すると `STATUS_ACCESS_VIOLATION` になることで確認済み。

### 要望

`BRepBuilderAPI_Copy` を Rust 側から呼べるようにしてほしい。ブーリアン演算・`clean` の結果を deep copy することで入力への依存を断ち切り、ヒープ破壊を解消できる。

---

## 要望2：BRepPrimAPI_MakeHalfSpace の公開

### 問題

形状を軸平行な平面で2分割する処理を、巨大ボックス（`BIG = 10_000`）で `intersect` / `subtract` することで代用している。数値的に不安定で、不要な面を大量に処理する原因になっている。

### 要望

`BRepPrimAPI_MakeHalfSpace` を Rust 側から呼べるようにしてほしい。あわせて、無限平面 Face を生成する手段も必要になる。`BRepBuilderAPI_MakeFace` は wrap 済みだが、平面（`gp_Pln` または `Geom_Plane`）から Face を生成する経路が現状では通っていないため、そちらも対応をお願いしたい。

---

## 優先度

| 要望 | 優先度 |
|------|--------|
| `BRepBuilderAPI_Copy` | **高**（ヒープ破壊の修正に必須） |
| `BRepPrimAPI_MakeHalfSpace` + 平面 Face 生成 | 中（現状の代用実装で動作はする） |
