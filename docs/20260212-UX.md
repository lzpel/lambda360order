
# 2026-02-12 UX設計案

## 1. コンセプト

Google MapsをWebサイトに埋め込むのと同じ手軽さで、**「パラメトリック3D見積もりフォーム」** を導入できるUXを提供します。
システム全体は、以下の入力と出力を持つ「関数」として振る舞います。

$$ Result = f(\text{商品仕様パラメータ}) $$

- **入力**: ユーザーが指定する寸法、素材、加工位置などのパラメータ
- **出力**:
  - **3D形状**: ブラウザでグリグリ動かせるBRep/Meshデータ
  - **見積もり**: リアルタイム計算された価格と納期
  - **PDF図面**: その場で生成される承認用図面（DXF/PDF）

---

## 2. 使用例のHTML (Developer Experience)

Web担当者は、発行されたAPIキーを使ってSDKを読み込み、HTMLタグで商品のロジックを記述します。

### 基本的な例: 直方体のオーダー

```html
<!DOCTYPE html>
<html>
<head>
  <!-- SDKの読み込み -->
  <script src="https://cdn.lambda360.com/v1/sdk.js?key=YOUR_API_KEY"></script>
</head>
<body>

  <!-- 3Dビューアとフォームのコンテナ -->
  <lambda360-order id="my-shelf-order">
    <!-- パラメータ定義: これがUI（スライダーや入力欄）として自動生成される -->
    <l360-param name="width" label="幅(mm)" type="number" min="100" max="2000" default="800"></l360-param>
    <l360-param name="height" label="高さ(mm)" type="number" min="500" max="1800" default="1000"></l360-param>
    <l360-param name="material" label="素材" type="select" options="SUS304:ステンレス, AL5052:アルミ, SPCC:鉄"></l360-param>

    <!-- 形状定義 (宣言的CAD) -->
    <l360-model>
      <!-- 直方体を定義 -->
      <l360-box w="{width}" h="{height}" d="400" material="{material}"></l360-box>
    </l360-model>

    <!-- 見積もりロジック -->
    <l360-price>
      <l360-rule base="5000">
        <!-- 幅と高さに応じて加算 -->
        <l360-calc formula="base + (width * 5) + (height * 3)"></l360-calc>
        <!-- ステンレスなら1.5倍 -->
        <l360-calc if="material == 'SUS304'" formula="price * 1.5"></l360-calc>
      </l360-rule>
    </l360-price>
  </lambda360-order>

  <script>
    // 発注イベントのハンドリング
    const orderComponent = document.getElementById('my-shelf-order');
    orderComponent.addEventListener('order', (e) => {
      console.log("注文確定:", e.detail);
      // e.detail には { params: {...}, price: 12000, pdfUrl: "..." } などが含まれる
    });
  </script>

</body>
</html>
```

### 高度な例: 既存STEPファイルへの追加工（穴あけ）

ベースとなるSTEPファイルをサーバーでBRepに変換・キャッシュし、Web上で定義されたパラメータに基づいてBoolean演算（穴あけ等）を行います。

```html
<lambda360-order>
  <l360-param name="hole_x" label="穴位置X" min="10" max="90"></l360-param>
  
  <l360-model>
    <!-- 差分演算 (Difference) -->
    <l360-operation type="cut">
      <!-- ベース形状: サーバー上のSTEPファイル（初回ロード時にBRep変換されキャッシュされる） -->
      <l360-import src="https://example.com/assets/base_plate.step"></l360-import>
      
      <!-- 削る形状: パラメータ連動する円柱 -->
      <l360-cylinder r="5" h="50" x="{hole_x}" y="20" z="0"></l360-cylinder>
    </l360-operation>
  </l360-model>
</lambda360-order>
```

---

## 3. 業務フローへの組み込み提案

金属加工・木材加工業者の既存フローを尊重しつつ、段階的にDXを実現する3つのパターンを提案します。

### パターンA: 「メール通知モデル」（小規模・アナログ重視）
FAXやメールでの受注が中心の現場向け。システム改修ほぼゼロで導入可能。

1.  **ユーザー**: Web上で形状確認・見積もり → 「見積もり依頼/発注」ボタンを押す。
2.  **Lambda360**: 
    - パラメータ付きの **PDF図面** と **見積書** を自動生成。
    - メーカー担当者とユーザー双方にメール送信。
3.  **メーカー**: メール添付のPDFを見て、従来通り生産管理システムに入力したり、現場へ指示出しを行う。

### パターンB: 「ECカート連携モデル」（中規模・Shopify/WooCommerce等）
既にECサイトを持っているが、特注品の扱いに困っている場合。

1.  **ユーザー**: Lambda360のビューアで仕様決定 → 「カートに入れる」ボタンを押す。
2.  **Lambda360**: 
    - ECサイトのカートに「特注品（SKU: CUSTOM-001）」として商品を投入。
    - **カスタム属性（Custom Attributes）** として、生成された「構成ID（Configuration ID）」やPDFのURLを紐付ける。
3.  **メーカー**: ECの管理画面で注文を確認。カスタム属性のURLから図面PDFをダウンロードして製造。

### パターンC: 「API/Webhook連携モデル」（大規模・DX先進企業）
生産管理システムやERPと直結させ、自動化を最大化する。

1.  **ユーザー**: 注文確定。
2.  **Lambda360**: メーカーのAPIエンドポイントへWebhook（JSON）を送信。
    - 形状データ（STEP/IGES）、加工パラメータ、価格情報を直接送信。
3.  **メーカー**: 
    - 社内システムがJSONを受信し、自動で受注伝票を発行。
    - CAMソフトへ形状データを流し込み、加工プログラム生成を半自動化。

---

## 4. サーバーサイド処理フロー (STEP加工の場合)

1.  **初回アクセス**:
    - クライアント: `<l360-import src="base.step">` をリクエスト。
    - サーバー: `base.step` を取得し、OpenCascadeで **BRep形式（テキストまたはバイナリ）** に変換。
    - サーバー: S3等に `base.brep` としてキャッシュ保存。
2.  **加工・表示**:
    - サーバー/WASM: キャッシュされた `base.brep` をロード（STEPパースより高速）。
    - サーバー/WASM: パラメータ `{hole_x}` に基づき、一時的な円柱を作成し、Boolean演算（Cut）を実行。
    - クライアント: 結果のメッシュを表示。