# 20260223-リファクタリングと新機能追加.md

## 新しい方向性の問題１：Order機能の実装

箱のサイズを入力して、glbが表示され見積書とstepのダウンロードができるまでの機能

## 新しい方向性の問題２：Stretch機能の確認

まず板金の箱を用意 plate_box.step

Stretch機能を確認するページをフロントエンドに追加

## 累積的なリファクタリングの課題

api/src/step_to_brep.rs この中汚すぎ、ただハートビーツしたいだけなのにこんなにbox pin arcまみれになるのはおかしいと思う

s3のキー設計も改善点がある、拡張子を排除したい、claudeからはそもそもstepファイルとbrepファイルを両方保存するのをやめてbrepだけにしたら？と言われている。

以下を使ってtempにglbを保存したい,temp/sessionは1日だけ、他は180日のキャッシュ。フロントエンドはまずキャッシュヒットを試す。
>s3の消滅時間って特定のパスだけはやめたりできない？基本180日だけど/uploaded以下は一日みたいな

```
質問：
S3で基本180日削除だが、/uploaded以下だけ1日にできる？

回答：
できます。S3はプレフィックス（パス）ごとに複数のライフサイクルルールを設定可能です。
例：
uploaded/ → 1日で削除
それ以外 → 180日で削除

同一バケット内で共存できます。より具体的なパス（uploaded/）が全体ルールより優先されます。削除は指定日から最大24時間ほど遅れることがあります。
```